; Listing generated by Microsoft (R) Optimizing Compiler Version 19.41.34123.0 

	TITLE	C:\Users\RafaTheFox\Desktop\SRB2-Public-master (1)\SRB2-Public-master\objs\VC10\Win32\Debug\r_sky.obj
	.686P
	.XMM
	include listing.inc
	.model	flat

INCLUDELIB LIBCMTD
INCLUDELIB OLDNAMES

_DATA	SEGMENT
COMM	_ATTRPACK:DWORD
COMM	_skytexture:DWORD
COMM	_skytexturemid:DWORD
COMM	_skyscale:DWORD
COMM	_skyflatnum:DWORD
COMM	_levelskynum:DWORD
COMM	_globallevelskynum:DWORD
_DATA	ENDS
PUBLIC	_R_SetupSkyDraw
PUBLIC	_R_SetSkyScale
EXTRN	_abs:PROC
EXTRN	_FixedDiv2:PROC
EXTRN	_viewwidth:DWORD
EXTRN	_wallcolfunc:DWORD
EXTRN	_vid:BYTE
EXTRN	_walldrawerfunc:DWORD
EXTRN	_textures:DWORD
; Function compile flags: /Odtp /ZI
; File C:\Users\RafaTheFox\Desktop\SRB2-Public-master (1)\SRB2-Public-master\src\r_sky.c
;	COMDAT _R_SetSkyScale
_TEXT	SEGMENT
_R_SetSkyScale PROC					; COMDAT

; 88   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 89   : 	skyscale = FixedDiv(FRACUNIT/2, (((vid.height*viewwidth)/vid.width)<<FRACBITS)/BASEVIDHEIGHT)<<1;

  00009	a1 10 00 00 00	 mov	 eax, DWORD PTR _vid+16
  0000e	0f af 05 00 00
	00 00		 imul	 eax, DWORD PTR _viewwidth
  00015	99		 cdq
  00016	f7 3d 0c 00 00
	00		 idiv	 DWORD PTR _vid+12
  0001c	c1 e0 10	 shl	 eax, 16			; 00000010H
  0001f	99		 cdq
  00020	b9 c8 00 00 00	 mov	 ecx, 200		; 000000c8H
  00025	f7 f9		 idiv	 ecx
  00027	50		 push	 eax
  00028	68 00 80 00 00	 push	 32768			; 00008000H
  0002d	e8 00 00 00 00	 call	 _FixedDiv
  00032	83 c4 08	 add	 esp, 8
  00035	d1 e0		 shl	 eax, 1
  00037	a3 00 00 00 00	 mov	 DWORD PTR _skyscale, eax

; 90   : }

  0003c	5f		 pop	 edi
  0003d	5e		 pop	 esi
  0003e	5b		 pop	 ebx
  0003f	8b e5		 mov	 esp, ebp
  00041	5d		 pop	 ebp
  00042	c3		 ret	 0
_R_SetSkyScale ENDP
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File C:\Users\RafaTheFox\Desktop\SRB2-Public-master (1)\SRB2-Public-master\src\r_sky.c
;	COMDAT _R_SetupSkyDraw
_TEXT	SEGMENT
_R_SetupSkyDraw PROC					; COMDAT

; 70   : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 40	 sub	 esp, 64			; 00000040H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 71   : 	// the horizon line in a 256x128 sky texture
; 72   : 	skytexturemid = (textures[skytexture]->height/2)<<FRACBITS;

  00009	a1 00 00 00 00	 mov	 eax, DWORD PTR _skytexture
  0000e	8b 0d 00 00 00
	00		 mov	 ecx, DWORD PTR _textures
  00014	8b 14 81	 mov	 edx, DWORD PTR [ecx+eax*4]
  00017	0f bf 42 0a	 movsx	 eax, WORD PTR [edx+10]
  0001b	99		 cdq
  0001c	2b c2		 sub	 eax, edx
  0001e	d1 f8		 sar	 eax, 1
  00020	c1 e0 10	 shl	 eax, 16			; 00000010H
  00023	a3 00 00 00 00	 mov	 DWORD PTR _skytexturemid, eax

; 73   : 
; 74   : 	// get the right drawer, it was set by screen.c, depending on the
; 75   : 	// current video mode bytes per pixel (quick fix)
; 76   : 	wallcolfunc = walldrawerfunc;

  00028	a1 00 00 00 00	 mov	 eax, DWORD PTR _walldrawerfunc
  0002d	a3 00 00 00 00	 mov	 DWORD PTR _wallcolfunc, eax

; 77   : 
; 78   : 	R_SetSkyScale();

  00032	e8 00 00 00 00	 call	 _R_SetSkyScale
  00037	90		 npad	 1

; 79   : }

  00038	5f		 pop	 edi
  00039	5e		 pop	 esi
  0003a	5b		 pop	 ebx
  0003b	8b e5		 mov	 esp, ebp
  0003d	5d		 pop	 ebp
  0003e	c3		 ret	 0
_R_SetupSkyDraw ENDP
_TEXT	ENDS
; Function compile flags: /Odtp /ZI
; File C:\Users\RafaTheFox\Desktop\SRB2-Public-master (1)\SRB2-Public-master\src\m_fixed.h
;	COMDAT _FixedDiv
_TEXT	SEGMENT
tv72 = -68						; size = 4
_a$ = 8							; size = 4
_b$ = 12						; size = 4
_FixedDiv PROC						; COMDAT

; 235  : {

  00000	55		 push	 ebp
  00001	8b ec		 mov	 ebp, esp
  00003	83 ec 44	 sub	 esp, 68			; 00000044H
  00006	53		 push	 ebx
  00007	56		 push	 esi
  00008	57		 push	 edi

; 236  : 	if ((abs(a) >> (FRACBITS-2)) >= abs(b))

  00009	8b 45 08	 mov	 eax, DWORD PTR _a$[ebp]
  0000c	50		 push	 eax
  0000d	e8 00 00 00 00	 call	 _abs
  00012	83 c4 04	 add	 esp, 4
  00015	8b f0		 mov	 esi, eax
  00017	c1 fe 0e	 sar	 esi, 14			; 0000000eH
  0001a	8b 4d 0c	 mov	 ecx, DWORD PTR _b$[ebp]
  0001d	51		 push	 ecx
  0001e	e8 00 00 00 00	 call	 _abs
  00023	83 c4 04	 add	 esp, 4
  00026	3b f0		 cmp	 esi, eax
  00028	7c 1d		 jl	 SHORT $LN2@FixedDiv

; 237  : 		return (a^b) < 0 ? INT32_MIN : INT32_MAX;

  0002a	8b 45 08	 mov	 eax, DWORD PTR _a$[ebp]
  0002d	33 45 0c	 xor	 eax, DWORD PTR _b$[ebp]
  00030	7d 09		 jge	 SHORT $LN4@FixedDiv
  00032	c7 45 bc 00 00
	00 80		 mov	 DWORD PTR tv72[ebp], -2147483648 ; 80000000H
  00039	eb 07		 jmp	 SHORT $LN5@FixedDiv
$LN4@FixedDiv:
  0003b	c7 45 bc ff ff
	ff 7f		 mov	 DWORD PTR tv72[ebp], 2147483647 ; 7fffffffH
$LN5@FixedDiv:
  00042	8b 45 bc	 mov	 eax, DWORD PTR tv72[ebp]
  00045	eb 10		 jmp	 SHORT $LN1@FixedDiv
$LN2@FixedDiv:

; 238  : 
; 239  : 	return FixedDiv2(a, b);

  00047	8b 45 0c	 mov	 eax, DWORD PTR _b$[ebp]
  0004a	50		 push	 eax
  0004b	8b 4d 08	 mov	 ecx, DWORD PTR _a$[ebp]
  0004e	51		 push	 ecx
  0004f	e8 00 00 00 00	 call	 _FixedDiv2
  00054	83 c4 08	 add	 esp, 8
$LN1@FixedDiv:

; 240  : }

  00057	5f		 pop	 edi
  00058	5e		 pop	 esi
  00059	5b		 pop	 ebx
  0005a	8b e5		 mov	 esp, ebp
  0005c	5d		 pop	 ebp
  0005d	c3		 ret	 0
_FixedDiv ENDP
_TEXT	ENDS
END
